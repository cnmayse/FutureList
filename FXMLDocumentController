/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package shopping.list.csc340.project2;

import java.net.URL;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.ResourceBundle;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.event.Event;
import javafx.event.EventHandler;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.Node;
import javafx.scene.control.Button;
import javafx.scene.control.ComboBox;
import javafx.scene.control.DatePicker;
import javafx.scene.control.Label;
import javafx.scene.control.ListView;
import javafx.scene.control.TextField;
import javafx.scene.layout.Pane;
import javafx.scene.layout.VBox;

/**
 *
 * @author Matthew Yengle
 */
public class FXMLDocumentController implements Initializable {
    /**
     * fx:id variable names
     */    
    @FXML
    private TextField AddItemName1,  AddItemName2,  AddItemName3,  AddItemName4, AddPrice1, AddPrice2, AddPrice3,AddPrice4, AddQuantity1, AddQuantity2, AddQuantity3, AddQuantity4; 
    @FXML
    private ComboBox AddStoreName1, AddStoreName2,AddStoreName3, AddStoreName4, AddStoreNameAll, AddCategory1, AddCategory2, AddCategory3, AddCategory4, AddCategoryAll;
    @FXML
    private VBox ListVBox, UpcomingVBox;
    @FXML
    private Pane CalendarPane;
    @FXML
    private DatePicker AddCalendar;
    @FXML 
    private Button AddItemsButton;    
    @FXML
    private VBox AddDateList, AddItemNameList, AddPriceList, AddStoreNameList, AddCategoryList;
    @FXML
    private Label AddMessageDate;
        
    /**
     * Global variables
     */
    private TextField[] AddItemNameArray, AddPriceArray;
    private ComboBox[] AddStoreNameArray, AddCategoryArray;    
    private LocalDate thisDate;    
    Purchase newPurchase;
    PurchaseCategory category;
    StoreName storeName;
    
    /**
     * This method handles when the "Add Items" button is clicked 
     */
    @FXML
    private void handleAddButtonAction(ActionEvent event) {  
        /**
         * Create an array for each type of field for easier access
         */
        AddItemNameArray = new TextField[]{AddItemName1, AddItemName2, AddItemName3, AddItemName4};
        AddPriceArray = new TextField[]{AddPrice1, AddPrice2, AddPrice3, AddPrice4};
        AddStoreNameArray = new ComboBox[]{AddStoreName1, AddStoreName2, AddStoreName3, AddStoreName4};
        AddCategoryArray = new ComboBox[]{AddCategory1, AddCategory2, AddCategory3, AddCategory4};        
        
        /**
         * A purchase needs to have a Item Name at minumum
         * If the purchase does not have an Item Name, continue the loop
         * 
         * A null String can not parse to an int, if else statement is used to detect a null Price value
         */
        for(int i =0; i <4; i++){            
            if(AddItemNameArray[i] == null){
                continue;
            }
            if(AddPrice1.getText() == null){
                addNewPurchase(AddItemNameArray[i].getText(), Double.parseDouble( AddPriceArray[i].getText()), (StoreName) AddStoreNameArray[i].getValue(), (PurchaseCategory)AddCategoryArray[i].getValue());
            }else{
                addNewPurchase(AddItemNameArray[i].getText(), (Double) null, (StoreName) AddStoreNameArray[i].getValue(), (PurchaseCategory)AddCategoryArray[i].getValue());
            }            
        }
        
        /**
         * Populate the entries for the List of Purchases made today and clear the parameters
         */
        populateList();
        clearFields();
     
    }
    
    /**
     * If used, the fifth drop-down box for StoreName and Category will set 
     * all four  drop-down values for their respective parameter to the fifth's value
     */
    @FXML
    private void handleStoreNameAllAction(ActionEvent event){
        AddStoreName1.setValue(AddStoreNameAll.getValue());
        AddStoreName2.setValue(AddStoreNameAll.getValue());
        AddStoreName3.setValue(AddStoreNameAll.getValue());
        AddStoreName4.setValue(AddStoreNameAll.getValue());
    }
    
    @FXML
    private void handleCategoryAllAction(ActionEvent event){
        AddCategory1.setValue(AddCategoryAll.getValue());
        AddCategory2.setValue(AddCategoryAll.getValue());
        AddCategory3.setValue(AddCategoryAll.getValue());
        AddCategory4.setValue(AddCategoryAll.getValue());
    }
    /**
     * Changes the date, based on their choice in the calender, that the purchases are made on
     */
    @FXML
    private void handleAddChangeDateAction(ActionEvent event){
        thisDate = AddCalendar.getValue();
        AddMessageDate.setText("Add New Items for " + thisDate.getMonth() + " " +  thisDate.getDayOfMonth() + ", " + thisDate.getYear());
        AddDateList.getChildren().clear();
        AddItemNameList.getChildren().clear();
        AddPriceList.getChildren().clear();
        AddStoreNameList.getChildren().clear();
        AddCategoryList.getChildren().clear();
    }
    
    /**
     * Starting point for the class
     * Sets the current date
     * Initalizes the values for Store Name and Category
     */
    @Override
    public void initialize(URL url, ResourceBundle rb) {                              
        thisDate = LocalDate.now();       
        AddMessageDate.setText("Add New Items for " + thisDate.getMonth() + " " +  thisDate.getDayOfMonth() + ", " + thisDate.getYear());        
        initAddItems();        
    }    
    
    /**
     * Initializes the values for Store Name and Category
     */
    public void initAddItems(){       
        AddCategory1.getItems().addAll(category.AUTOMOTIVE, category.CLOTHING, category.FOOD, category.ETC_DAILY, category.ETC_WEEKLY, category.ETC_MONTHLY, category.ETC_YEARLY, category.HOLIDAY,
        category.LEISURE, category.TRAVEL);
        AddCategory2.getItems().addAll(category.AUTOMOTIVE, category.CLOTHING, category.FOOD, category.ETC_DAILY, category.ETC_WEEKLY, category.ETC_MONTHLY, category.ETC_YEARLY, category.HOLIDAY,
        category.LEISURE, category.TRAVEL);
        AddCategory3.getItems().addAll(category.AUTOMOTIVE, category.CLOTHING, category.FOOD, category.ETC_DAILY, category.ETC_WEEKLY, category.ETC_MONTHLY, category.ETC_YEARLY, category.HOLIDAY,
        category.LEISURE, category.TRAVEL);
        AddCategory4.getItems().addAll(category.AUTOMOTIVE, category.CLOTHING, category.FOOD, category.ETC_DAILY, category.ETC_WEEKLY, category.ETC_MONTHLY, category.ETC_YEARLY, category.HOLIDAY,
        category.LEISURE, category.TRAVEL);
        AddCategoryAll.getItems().addAll(category.AUTOMOTIVE, category.CLOTHING, category.FOOD, category.ETC_DAILY, category.ETC_WEEKLY, category.ETC_MONTHLY, category.ETC_YEARLY, category.HOLIDAY,
        category.LEISURE, category.TRAVEL);
        
        AddStoreName1.getItems().addAll(storeName.AMAZON, storeName.HARRIS_TEETER, storeName.SHEETZ, storeName.TARGET, storeName.WALMART);
        AddStoreName2.getItems().addAll(storeName.AMAZON, storeName.HARRIS_TEETER, storeName.SHEETZ, storeName.TARGET, storeName.WALMART);
        AddStoreName3.getItems().addAll(storeName.AMAZON, storeName.HARRIS_TEETER, storeName.SHEETZ, storeName.TARGET, storeName.WALMART);
        AddStoreName4.getItems().addAll(storeName.AMAZON, storeName.HARRIS_TEETER, storeName.SHEETZ, storeName.TARGET, storeName.WALMART);
        AddStoreNameAll.getItems().addAll(storeName.AMAZON, storeName.HARRIS_TEETER, storeName.SHEETZ, storeName.TARGET, storeName.WALMART);        
    }
    
    /**
     * Method to add a new Purchase
     * 
     * @param name
     * @param price
     * @param store
     * @param cat 
     */
    public void addNewPurchase(String name, Double price, StoreName store, PurchaseCategory cat){        
        newPurchase = new Purchase(name, thisDate, price, store, cat);
    }
    
    /**
     * Updates the list that keep track of the purchases made today in a top down fashion
     */
    private void populateList() {
        VBox tempBox = new VBox();
        
        for(int i = 0; i < 4; i++){
            if(AddItemNameArray[i].getText().equals(""))
                continue;
                      
            tempBox.getChildren().addAll(AddDateList.getChildren());
            AddDateList.getChildren().clear();
            AddDateList.getChildren().addAll(new Label(thisDate.toString()));             
            AddDateList.getChildren().addAll(tempBox.getChildren());        
            tempBox.getChildren().clear();
                          
            tempBox.getChildren().addAll(AddItemNameList.getChildren());
            AddItemNameList.getChildren().clear();
            AddItemNameList.getChildren().addAll(new Label(AddItemNameArray[i].getText()));
            AddItemNameList.getChildren().addAll(tempBox.getChildren());        
            tempBox.getChildren().clear();
             
            tempBox.getChildren().addAll(AddPriceList.getChildren());
            AddPriceList.getChildren().clear();
            AddPriceList.getChildren().addAll(new Label(AddPriceArray[i].getText()));
            AddPriceList.getChildren().addAll(tempBox.getChildren());        
            tempBox.getChildren().clear();         
           
            tempBox.getChildren().addAll(AddStoreNameList.getChildren());
            AddStoreNameList.getChildren().clear();
            if(AddStoreNameArray[i] == (null) || AddStoreNameArray[i].getValue() == (null)){   
                 AddStoreNameList.getChildren().addAll(new Label(""));      
            }else{
                 AddStoreNameList.getChildren().addAll(new Label(AddStoreNameArray[i].getValue().toString()));
            }
            AddStoreNameList.getChildren().addAll(tempBox.getChildren());        
            tempBox.getChildren().clear();   
            
            tempBox.getChildren().addAll(AddCategoryList.getChildren());
            AddCategoryList.getChildren().clear();            
            if(AddCategoryArray[i] == (null) || AddCategoryArray[i].getValue() == (null)){      
                 AddCategoryList.getChildren().addAll(new Label(""));      
            }else{
                AddCategoryList.getChildren().addAll(new Label(AddCategoryArray[i].getValue().toString()));
            }
            AddCategoryList.getChildren().addAll(tempBox.getChildren());        
            tempBox.getChildren().clear();           
        }   
    }
    
    /**
     * Clears all the parameters when the Add Items button has been clicked
     */
    private void clearFields(){
        for(int i =0; i < 4; i++){
            AddItemNameArray[i].setText("");
            AddPriceArray[i].setText("");
            AddStoreNameArray[i].setValue(null);
            AddCategoryArray[i].setValue(null);
        }
        AddStoreNameAll.setValue(null);
        AddCategoryAll.setValue(null);
    }
}
